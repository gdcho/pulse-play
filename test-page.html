<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pulse Play - Video Speed Test Page</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(
          135deg,
          #f5f5f5 0%,
          #e8eaf6 50%,
          #f3e5f5 100%
        );
      }
      .title-container {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 20px;
        justify-content: center;
      }

      .header-logo {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        box-shadow: 0 0 20px rgba(251, 83, 84, 0.5);
        animation: headerLogoGlow 2s ease-in-out infinite alternate;
      }

      @keyframes headerLogoGlow {
        0% {
          box-shadow: 0 0 20px rgba(251, 83, 84, 0.5);
          transform: scale(1);
        }
        100% {
          box-shadow: 0 0 30px rgba(251, 83, 84, 0.9),
            0 0 40px rgba(142, 65, 152, 0.5);
          transform: scale(1.05);
        }
      }

      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #fb5354;
        text-align: center;
        margin: 0;
        font-size: 36px;
        font-weight: 700;
        text-shadow: 0 2px 6px rgba(251, 83, 84, 0.3);
      }
      .test-section {
        margin: 20px 0;
        padding: 20px;
        border: 2px solid #656ab8;
        border-radius: 12px;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        box-shadow: 0 4px 15px rgba(101, 106, 184, 0.1);
      }
      .test-section h3 {
        margin-top: 0;
        color: #555;
      }
      video {
        width: 100%;
        max-width: 600px;
        height: auto;
        border: 2px solid #007cba;
        border-radius: 5px;
        margin: 10px 0;
      }
      .controls {
        text-align: center;
        margin: 20px 0;
      }
      button {
        background-color: #656ab8;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }
      button:hover {
        background-color: #8e4198;
      }
      .status {
        background-color: rgba(101, 106, 184, 0.1);
        border: 1px solid #656ab8;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .status h4 {
        margin-top: 0;
        color: #656ab8;
      }
      .key-info {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .key-info h4 {
        margin-top: 0;
        color: #856404;
      }
      .instructions {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .instructions h4 {
        margin-top: 0;
        color: #155724;
      }
      .debug-log {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
        max-height: 300px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
      }
      .debug-log h4 {
        margin-top: 0;
        color: #495057;
      }
      .log-entry {
        margin: 2px 0;
        padding: 2px 0;
      }
      .log-entry.info {
        color: #007cba;
      }
      .log-entry.warn {
        color: #856404;
      }
      .log-entry.error {
        color: #dc3545;
      }
      .log-entry.success {
        color: #155724;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="title-container">
        <img src="icons/pulse-play.png" alt="Pulse Play" class="header-logo" />
        <h1>Pulse Play</h1>
      </div>

      <div class="instructions">
        <h4>üìã Instructions</h4>
        <p>This page helps test the Video Speed Hotkey extension:</p>
        <ol>
          <li>Make sure the extension is installed and enabled</li>
          <li>Press and hold the configured hotkey (default: backquote `)</li>
          <li>Watch for the speed indicator overlay</li>
          <li>Check the console for debug information</li>
        </ol>
      </div>

      <div class="test-section">
        <h3>üé• Test Video</h3>
        <p>This video should respond to the hotkey:</p>
        <video id="test-video" controls>
          <source
            src="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4"
            type="video/mp4"
          />
          Your browser does not support the video tag.
        </video>
        <div class="controls">
          <button onclick="playVideo()">Play</button>
          <button onclick="pauseVideo()">Pause</button>
          <button onclick="resetVideo()">Reset</button>
        </div>
      </div>

      <div class="status">
        <h4>üîç Extension Status</h4>
        <div id="extension-status">Checking extension status...</div>
      </div>

      <div class="key-info">
        <h4>‚å®Ô∏è Hotkey Information</h4>
        <div id="hotkey-info">Loading hotkey info...</div>
      </div>

      <div class="debug-log">
        <h4>üìù Debug Log</h4>
        <div id="debug-log-content"></div>
      </div>

      <div class="test-section">
        <h3>üß™ Manual Testing</h3>
        <p>Press these keys to test detection:</p>
        <ul>
          <li><strong>Backquote (`)</strong> - Should trigger speed boost</li>
          <li><strong>Space</strong> - Alternative hotkey</li>
          <li><strong>Arrow Right</strong> - Another alternative</li>
        </ul>
        <p>
          <em
            >Note: Make sure you're not typing in any input fields when
            testing.</em
          >
        </p>
      </div>
    </div>

    <script>
      // Debug logging function
      function log(message, type = "info") {
        const logContent = document.getElementById("debug-log-content");
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement("div");
        logEntry.className = `log-entry ${type}`;
        logEntry.textContent = `[${timestamp}] ${message}`;
        logContent.appendChild(logEntry);
        logContent.scrollTop = logContent.scrollHeight;

        // Also log to console
        console.log(`[${timestamp}] ${message}`);
      }

      // Check extension status
      function checkExtensionStatus() {
        if (typeof chrome !== "undefined" && chrome.runtime) {
          log("Chrome extension API available", "success");

          // Try to communicate with the extension
          chrome.runtime.sendMessage({ type: "GET_SETTINGS" }, (response) => {
            if (chrome.runtime.lastError) {
              log(
                `Extension communication error: ${chrome.runtime.lastError.message}`,
                "error",
              );
              document.getElementById("extension-status").innerHTML =
                '<span style="color: red;">‚ùå Extension not responding</span>';
            } else if (response && response.success) {
              log("Extension responding successfully", "success");
              log(
                `Settings loaded: ${JSON.stringify(response.settings)}`,
                "info",
              );

              document.getElementById("extension-status").innerHTML =
                '<span style="color: green;">‚úÖ Extension active</span>';

              // Display hotkey info
              const hotkey = response.settings.hotkey;
              document.getElementById("hotkey-info").innerHTML = `
                            <strong>Configured Hotkey:</strong> ${
                              hotkey.key
                            }<br>
                            <strong>Modifiers:</strong> ${
                              hotkey.modifiers.join(", ") || "None"
                            }<br>
                            <strong>Enabled:</strong> ${
                              hotkey.enabled ? "Yes" : "No"
                            }<br>
                            <strong>Speed Multiplier:</strong> ${
                              response.settings.speedMultiplier
                            }x
                        `;
            } else {
              log("Extension responded but with error", "warn");
              document.getElementById("extension-status").innerHTML =
                '<span style="color: orange;">‚ö†Ô∏è Extension error</span>';
            }
          });
        } else {
          log("Chrome extension API not available", "error");
          document.getElementById("extension-status").innerHTML =
            '<span style="color: red;">‚ùå Not running in Chrome extension context</span>';
        }
      }

      // Video control functions
      function playVideo() {
        const video = document.getElementById("test-video");
        video.play();
        log("Video play requested", "info");
      }

      function pauseVideo() {
        const video = document.getElementById("test-video");
        video.pause();
        log("Video pause requested", "info");
      }

      function resetVideo() {
        const video = document.getElementById("test-video");
        video.currentTime = 0;
        video.playbackRate = 1.0;
        log("Video reset to beginning with normal speed", "info");
      }

      // Keyboard event monitoring
      document.addEventListener("keydown", (event) => {
        if (event.key === "`" || event.key === "~") {
          log(
            `Backquote keydown detected: key="${event.key}", code="${event.code}"`,
            "success",
          );
        } else if (event.key === " ") {
          log(
            `Space keydown detected: key="${event.key}", code="${event.code}"`,
            "info",
          );
        } else if (event.key === "ArrowRight") {
          log(
            `Right arrow keydown detected: key="${event.key}", code="${event.code}"`,
            "info",
          );
        }
      });

      document.addEventListener("keyup", (event) => {
        if (event.key === "`" || event.key === "~") {
          log(
            `Backquote keyup detected: key="${event.key}", code="${event.code}"`,
            "success",
          );
        }
      });

      // Check for speed indicator overlay
      function checkForSpeedIndicator() {
        const indicator = document.getElementById(
          "video-speed-hotkey-indicator",
        );
        if (indicator) {
          log("Speed indicator found in DOM", "success");
          log(`Indicator text: ${indicator.textContent}`, "info");
          log(
            `Indicator styles: ${JSON.stringify({
              opacity: indicator.style.opacity,
              display: indicator.style.display,
              visibility: indicator.style.visibility,
              zIndex: indicator.style.zIndex,
            })}`,
            "info",
          );
        } else {
          log("No speed indicator found in DOM", "warn");
        }
      }

      // Monitor for speed indicator changes
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === "childList") {
            mutation.addedNodes.forEach((node) => {
              if (node.id === "video-speed-hotkey-indicator") {
                log("Speed indicator added to DOM", "success");
                setTimeout(checkForSpeedIndicator, 100);
              }
            });
            mutation.removedNodes.forEach((node) => {
              if (node.id === "video-speed-hotkey-indicator") {
                log("Speed indicator removed from DOM", "info");
              }
            });
          }
        });
      });

      // Start observing
      observer.observe(document.body, {
        childList: true,
        subtree: true,
      });

      // Initialize page
      document.addEventListener("DOMContentLoaded", () => {
        log("Test page loaded", "success");
        checkExtensionStatus();

        // Check for speed indicator every few seconds
        setInterval(checkForSpeedIndicator, 2000);
      });

      // Log page visibility changes
      document.addEventListener("visibilitychange", () => {
        log(
          `Page visibility changed: ${document.hidden ? "hidden" : "visible"}`,
          "info",
        );
      });

      // Log when page gains/loses focus
      window.addEventListener("focus", () => {
        log("Window gained focus", "info");
      });

      window.addEventListener("blur", () => {
        log("Window lost focus", "info");
      });
    </script>
  </body>
</html>
